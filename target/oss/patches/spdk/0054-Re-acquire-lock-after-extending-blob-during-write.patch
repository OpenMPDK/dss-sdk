From 1bd35fb5ea1cfd25f77cdb899ae148e91e99a13a Mon Sep 17 00:00:00 2001
From: Benixon Arul dhas <benixon.a@samsung.com>
Date: Thu, 28 Oct 2021 10:46:01 -0700
Subject: [PATCH 54/71] Re-acquire lock after extending blob during write

    * Caused issue with cache buffer corruption during reclaim
---
 lib/blobfs/blobfs.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/blobfs/blobfs.c b/lib/blobfs/blobfs.c
index a3ba66120..afc56d435 100644
--- a/lib/blobfs/blobfs.c
+++ b/lib/blobfs/blobfs.c
@@ -2732,6 +2732,7 @@ spdk_file_write(struct spdk_file *file, struct spdk_fs_thread_ctx *ctx,
 		if (extend_args.rc) {
 			return extend_args.rc;
 		}
+		pthread_spin_lock(&file->lock);//re-accquire lock again after extend
 	}
 
 #ifdef WT_FLUSH
-- 
2.24.3

